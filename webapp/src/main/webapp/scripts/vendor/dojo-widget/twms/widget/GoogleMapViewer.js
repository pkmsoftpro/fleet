/*
	Copyright (c) 2004-2007, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

		http://dojotoolkit.org/book/dojo-book-0-9/introduction/licensing
*/


if(!dojo._hasResource["twms.widget.GoogleMapViewer"]){dojo._hasResource["twms.widget.GoogleMapViewer"]=true;dojo.provide("twms.widget.GoogleMapViewer");dojo.require("dijit.layout.LayoutContainer");dojo.require("twms.widget.Dialog");dojo.require("twms.widget.GoogleMap");dojo.declare("twms.widget.GoogleMapViewer",[dijit._Widget,dijit._Templated],{widgetsInTemplate:true,templateString:"<span class=\"googleMapViewerContainer\">\r\n    <button class='googleMapViewerIcon' dojoAttachPoint=\"iconNode\"></button>\r\n    <div style=\"display: none\">\r\n        <div dojoType=\"twms.widget.Dialog\" bgColor=\"#FFF\" toggle=\"fade\"\r\n             id=\"${id}_viewer\" toggleDuration=\"250\" title=\"${title}\" dojoAttachPoint=\"viewerNode\"\r\n             style=\"overflow-x: hidden;\">\r\n                <div dojoType=\"twms.widget.GoogleMap\" dojoAttachPoint=\"mapNode\" mapWidth=\"100%\"\r\n                     mapHeight=\"${viewerHeight}\" id=\"${id}_map\" allowScrollWheelZoom=\"true\" allowMapTypeSelection=\"true\"\r\n                     allowLargeMapControl=\"true\"></div>\r\n        </div>\r\n    </div>\r\n</span>\r\n",title:"Google Map Viewer...",fromAddress:"",address:"",viewerHeight:"300px",addressNode:"",ADDRESS_NOT_PROVIDED:"Please provide a valid address.",_viewer:null,_mapWidget:null,_disabled:false,_lastSeenAddress:null,postCreate:function(){this._viewer=dijit.byId(this.id+"_viewer");this._mapWidget=dijit.byId(this.id+"_map");var _1=this._mapWidget.addressResolutionNotificationTopic="/addressResolved/"+this.id;dojo.subscribe(_1,this,function(_2){var _3=_2.address?_2.address:_2.fromAddress+" to "+_2.toAddress;this._viewer.setTitle(_3);});if(!dojo.string.isBlank(this.addressNode)){this.addressNode=dojo.byId(this.addressNode);}dojo.connect(this.domNode,"onclick",this,function(_4){dojo.stopEvent(_4);if(this._disabled){return;}if(this.addressNode){this.address=this.addressNode.value;}if(dojo.string.isBlank(this.address)){this._mapWidget._showError(this.ADDRESS_NOT_PROVIDED);}else{if(this._lastSeenAddress!==this.address){this._lastSeenAddress=this.address;this._mapWidget._setMessageNodeDisplay(false);this._renderMapUsingAddress();}}this._viewer.show();});},_renderMapUsingAddress:function(){var _5=!dojo.string.isBlank(this.fromAddress);var _6;if(_5){_6=dojo.hitch(this._mapWidget,this._mapWidget.markDirection,this.fromAddress,this.address);}else{_6=dojo.hitch(this._mapWidget,this._mapWidget.markLocation,this.address);}this._viewer.setTitle("Loading Map...");this._mapWidget.addOnPreLoad(dojo.hitch(this._mapWidget,function(){this._map.clearOverlays();}));this._mapWidget.addOnPreLoad(_6);this._mapWidget.renderMap();},setDisabled:function(_7){dojo.addClass();this._disabled=_7;var _8=_7?dojo.addClass():dojo.removeClass;_8("googleMapViewerDisabled");}});}